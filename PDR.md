# 《超市 AI 营销系统》

**PDR · 程序设计说明书（第一次输出）**

---

## 一、项目概述

### 1.1 项目背景

在超市业务中，管理层希望利用现有销售数据，对客户进行更精细化运营，包括：

* 针对客户历史购买行为做个性化商品推荐；
* 为部分商品制定促销策略；
* 对未来销售额与利润进行简单预测；
* 对客户进行分群分析，为营销策略提供依据；
* 将主要分析结果通过语音播报的形式呈现，方便演示与汇报。

本项目以给定的 **“商城详细销售数据” CSV 文件** 为基础数据源，通过本地 Python 程序完成数据清洗、分析建模与结果展示，形成一个 **可在单机环境运行的超市 AI 营销演示系统**，用于本科毕业设计展示与答辩。

### 1.2 建设目标

1. 搭建一个本地运行的营销分析原型系统，覆盖：

   * 客户个性化推荐
   * 商品促销分析
   * 销售额与利润预测
   * 客户聚类分析
   * 语音播报结果展示
2. 所有功能以「能跑、可演示」为底线，算法采用经典、易实现的统计 / 机器学习方法。
3. 使用统一的本地数据库（或直接基于 CSV + 内存数据框），保证实现复杂度适合普通本科生。

### 1.3 业务需求对应关系

| 作业需求            | 本系统对应功能  | 说明                         |
| --------------- | -------- | -------------------------- |
| 1. 为每个客户个性化推荐产品 | 客户推荐模块   | 基于历史订单记录与购买频次 / 关联规则生成推荐列表 |
| 2. 为某些商品开展促销活动  | 商品促销分析模块 | 依据销售额、利润、折扣等指标筛选适合促销的商品集合  |
| 3. 预测未来销售额和利润   | 销售预测模块   | 按月份聚合销售额/利润，训练回归模型做短期预测    |
| 4. 对客户聚类分析      | 客户聚类模块   | 基于 RFM 等指标对客户进行 KMeans 聚类  |
| 5. 结果用语音播报      | 语音播报模块   | 通过本地 TTS 库将关键结论播报出来        |

---

## 二、系统功能模块与范围

### 2.1 模块结构概览

```text
超市 AI 营销系统
├─ 数据管理模块
│   ├─ 原始 CSV 导入
│   ├─ 数据清洗与预处理
│   └─ 维度表 / 事实表构建
├─ 客户推荐模块
│   ├─ 客户购物清单汇总（按订单 ID 合并）
│   ├─ 购买频次统计与相似客户分析
│   └─ 推荐商品生成与展示
├─ 商品促销分析模块
│   ├─ 销售与利润指标计算
│   ├─ 促销候选商品筛选规则
│   └─ 促销清单生成与导出
├─ 销售与利润预测模块
│   ├─ 时间序列聚合（按日/按月）
│   ├─ 特征构建与回归模型训练
│   └─ 未来周期预测与可视化
├─ 客户聚类分析模块
│   ├─ RFM 指标计算
│   ├─ KMeans 聚类训练
│   └─ 分群特征分析与标签说明
├─ 语音播报模块
│   ├─ 文本摘要生成
│   └─ 文本转语音（本地 TTS）
└─ 界面与交互模块
    ├─ 主菜单（命令行界面或简单图形界面）
    ├─ 各模块参数配置入口
    └─ 结果查询与图表展示
```

### 2.2 模块清单与功能范围

| 模块名称     | 核心功能                    | 说明                  |
| -------- | ----------------------- | ------------------- |
| 数据管理模块   | 读取 CSV、字段映射、缺失值处理、类型转换  | 为所有分析模块提供统一数据视图     |
| 客户推荐模块   | 根据历史订单生成客户购物清单，生成推荐商品列表 | 面向指定客户展示 Top N 推荐商品 |
| 商品促销分析模块 | 计算商品销售额/利润率，根据规则筛选促销对象  | 形成促销商品清单，可导出        |
| 销售预测模块   | 对历史销售额与利润进行时间聚合与回归预测    | 输出未来若干时间点的预测值       |
| 客户聚类模块   | 构建 RFM 指标，执行聚类，输出每类客户特征 | 支持按分群查看客户列表         |
| 语音播报模块   | 将分析结果生成说明文字，并转为语音播放     | 主要用于课堂演示            |
| 界面与交互模块  | 菜单导航、参数输入、结果表格与图表展示     | 使用简洁交互方式保证可用性       |

---

## 三、技术架构设计（本地可落地）

### 3.1 整体架构说明

本系统采用 **单机本地运行的 Python 应用**，可设计为：

* **应用层**：Python 程序，内部划分为数据管理、分析算法、可视化、语音播报等模块；
* **数据层**：

  * 直接读取原始 CSV 文件，使用 `pandas` 进行数据处理；
  * 可选：将清洗后的数据写入本地 `SQLite` 数据库，便于查询；
* **展示层**：

  * 基础版：命令行菜单 + 文本表格 + 简单图表弹窗（matplotlib）；
  * 若时间允许：使用 `Tkinter` 实现简单窗体界面。

### 3.2 技术选型

| 技术方向  | 选型                     | 用途                    |
| ----- | ---------------------- | --------------------- |
| 编程语言  | Python 3.x             | 全部业务逻辑与算法实现           |
| 数据处理  | `pandas`               | CSV 读取、清洗、聚合、特征构造     |
| 机器学习  | `scikit-learn`         | 回归预测（如线性回归）、KMeans 聚类 |
| 数据存储  | 原始 CSV + 可选 `SQLite`   | 原始数据与清洗后数据的存储         |
| 可视化   | `matplotlib`           | 销售趋势、聚类结果等图表          |
| 文本转语音 | `pyttsx3`（或其他本地 TTS 库） | 将文本结果转换为语音播报          |
| 界面    | 命令行 / Tkinter          | 提供用户操作入口与结果展示         |

**说明：**

* 不引入分布式、微服务、消息队列等复杂架构；
* 所有依赖均为常见 Python 第三方库，便于在本地环境安装与运行。

---

## 四、数据库概要设计

### 4.1 数据表概览

结合提供的字段（行 ID、订单 ID、订单日期、发货日期、邮寄方式、客户 ID、客户名称、细分、城市、省/自治区、国家、地区、产品 ID、类别、子类别、产品名称、销售额、数量、折扣、利润），进行适度拆分，形成如下逻辑表结构：

| 表名                        | 说明                   |
| ------------------------- | -------------------- |
| `dim_customer` 客户维度表      | 保存客户基础信息与细分标签        |
| `dim_product` 商品维度表       | 保存商品及品类信息            |
| `fact_order` 订单事实表        | 以订单为粒度记录订单基本信息       |
| `fact_order_item` 订单明细事实表 | 以行 ID 为粒度记录商品销售记录    |
| `dm_customer_rfm`（派生表）    | 按客户聚合后的 RFM 指标       |
| `dm_sales_summary`（派生表）   | 按日期 / 月份聚合后的销售额与利润信息 |

### 4.2 主要数据表字段设计（概要）

1）`dim_customer` 客户维度表

| 字段名             | 类型      | 说明               |
| --------------- | ------- | ---------------- |
| `customer_id`   | VARCHAR | 对应「客户 ID」        |
| `customer_name` | VARCHAR | 对应「客户名称」         |
| `segment`       | VARCHAR | 对应「细分」（如消费者、公司等） |
| `city`          | VARCHAR | 城市               |
| `province`      | VARCHAR | 省/自治区            |
| `country`       | VARCHAR | 国家               |
| `region`        | VARCHAR | 地区（华东、西南等）       |

2）`dim_product` 商品维度表

| 字段名            | 类型      | 说明          |
| -------------- | ------- | ----------- |
| `product_id`   | VARCHAR | 对应「产品 ID」   |
| `category`     | VARCHAR | 类别（办公用品等）   |
| `sub_category` | VARCHAR | 子类别（用品、信封等） |
| `product_name` | VARCHAR | 产品名称        |

3）`fact_order` 订单事实表

| 字段名           | 类型      | 说明                   |
| ------------- | ------- | -------------------- |
| `order_id`    | VARCHAR | 对应「订单 ID」            |
| `order_date`  | DATE    | 订单日期                 |
| `ship_date`   | DATE    | 发货日期                 |
| `ship_mode`   | VARCHAR | 邮寄方式（标准级、二级等）        |
| `customer_id` | VARCHAR | 外键，关联 `dim_customer` |
| `region`      | VARCHAR | 地区（冗余字段，便于查询）        |

4）`fact_order_item` 订单明细事实表

| 字段名          | 类型      | 说明                  |
| ------------ | ------- | ------------------- |
| `line_id`    | INT     | 对应「行 ID」，主键         |
| `order_id`   | VARCHAR | 外键，关联 `fact_order`  |
| `product_id` | VARCHAR | 外键，关联 `dim_product` |
| `sales`      | DECIMAL | 销售额                 |
| `quantity`   | INT     | 数量                  |
| `discount`   | DECIMAL | 折扣                  |
| `profit`     | DECIMAL | 利润                  |

5）`dm_customer_rfm` 客户 RFM 指标表（分析用）

| 字段名             | 类型      | 说明          |
| --------------- | ------- | ----------- |
| `customer_id`   | VARCHAR | 客户 ID       |
| `recency`       | INT     | 最近一次消费距今的天数 |
| `frequency`     | INT     | 一定时间内订单次数   |
| `monetary`      | DECIMAL | 一定时间内总消费金额  |
| `cluster_label` | INT     | 聚类分组编号      |

6）`dm_sales_summary` 销售汇总表（预测用）

| 字段名                        | 类型             | 说明      |
| -------------------------- | -------------- | ------- |
| `stat_date` / `stat_month` | DATE / VARCHAR | 统计日期或月份 |
| `total_sales`              | DECIMAL        | 总销售额    |
| `total_profit`             | DECIMAL        | 总利润     |

> 实际实现中，可以仅在内存中使用 `pandas DataFrame` 表示上述逻辑表结构，无必须落地为物理数据库。

---

## 五、核心算法设计概要

### 5.1 客户个性化推荐策略

1. **购物清单构建**

   * 按照「订单 ID」对明细数据进行合并，形成每个订单的商品集合；
   * 再按「客户 ID」聚合，构建客户的历史购物清单。

2. **推荐规则（可选其一或结合）：**

   * **基于购买频次的同品类推荐：**

     * 统计每位客户在不同「类别 / 子类别」上的消费次数与金额；
     * 对于高频类别，优先推荐该类别下客户未购买过的畅销商品。
   * **基于关联规则的推荐（选做）：**

     * 使用如 Apriori 的关联规则挖掘算法，挖掘「经常一起购买的商品组合」；
     * 对于已有商品集合，推荐与其存在高置信度规则的其他商品。

3. **输出形式：**

   * 支持输入：客户 ID；
   * 输出：Top N 推荐商品列表（含商品名称、所属子类别、预估理由简述）。

### 5.2 商品促销分析策略

1. 计算每个商品的指标：

   * 累计销售额、销售数量、总利润；
   * 平均折扣、利润率（总利润 / 销售额）；
   * 最近一段时间（如近 3 个月）销售趋势。

2. 设计促销规则示例（可配置）：

   * **规则 A：** 销量较低但利润率较高的商品，适合通过促销拉动销量；
   * **规则 B：** 销量较高但利润率偏低的商品，可通过小幅促销提升客流与关联销售；
   * **规则 C：** 长期滞销商品，通过大力度促销清理库存。

3. 输出：

   * 按规则生成促销候选商品列表；
   * 展示促销前销售数据，为课堂讲解提供依据。

### 5.3 销售额与利润预测策略

1. **时间粒度选择：**

   * 以「月份」为粒度，对订单明细按月聚合销售额与利润。

2. **建模步骤：**

   * 将月份映射为时间特征（例如递增的整数索引或年月编码）；
   * 使用简洁的 **回归模型**（如线性回归、多项式回归等）拟合历史数据；
   * 预测未来若干月份的销售额与利润。

3. **可视化：**

   * 使用折线图显示「历史实际值 vs 模型预测值」；
   * 在演示时，通过语音播报总结「预计下月销售额/利润」。

### 5.4 客户聚类分析策略

1. 构建 RFM 指标：

   * R（Recency）：最近一次购买时间距今的天数；
   * F（Frequency）：统计期内订单次数；
   * M（Monetary）：统计期内总消费金额。

2. 数据预处理：

   * 对 R、F、M 指标进行标准化或归一化，避免量纲影响；
   * 处理异常值与极端值。

3. 聚类算法：

   * 采用 **KMeans 聚类**；
   * 通过肘部法等简单方法，确定合理的聚类数（如 3～5 类）。

4. 分群解释：

   * 对各类的平均 R/F/M 值进行分析，给出业务含义：

     * 如「高价值忠诚客户」「潜力客户」「价格敏感型客户」等。

### 5.5 语音播报模块设计

1. 文本生成：

   * 对各分析模块的核心结果生成简短中文摘要，例如：

     * 销售预测结果总结；
     * 客户聚类概况；
     * 某客户的推荐商品说明等。

2. 文本转语音：

   * 使用本地 TTS 库（如 `pyttsx3`），避免依赖网络服务；
   * 支持设置语速、音量等基础参数。

3. 播放控制：

   * 在主界面提供「播报结果」按钮/菜单项；
   * 支持选择播报内容类型（预测结果 / 促销建议 / 客户推荐等）。

---

## 六、功能优先级（Must / Should / Could）

| 模块 / 功能           | 描述                    | 优先级    |
| ----------------- | --------------------- | ------ |
| 数据导入与清洗           | 读取 CSV，完成基础清洗与格式转换    | Must   |
| 客户购物清单构建          | 按订单 ID 合并，得到每个客户的商品集合 | Must   |
| 客户 Top N 推荐       | 基于购买频次或简单规则生成推荐列表     | Must   |
| 商品促销候选筛选          | 根据设定规则输出促销商品列表        | Must   |
| 按月销售额/利润聚合        | 用于后续预测的数据加工           | Must   |
| 销售额/利润简单预测        | 使用线性回归等模型预测未来一段时间     | Must   |
| 客户 RFM 指标计算       | 计算每个客户的 R/F/M         | Must   |
| KMeans 聚类与分群结果展示  | 输出每个客户的聚类标签与分群描述      | Must   |
| 结果语音播报            | 将主要分析结论通过语音输出         | Must   |
| 命令行主菜单界面          | 支持用户在不同功能间切换          | Must   |
| 图表展示（趋势图、饼图等）     | 显示销售趋势、分群占比等          | Should |
| 参数配置界面（阈值、聚类数等）   | 在界面中调整部分算法参数          | Should |
| 结果导出为 CSV / Excel | 将推荐列表、促销商品清单导出        | Should |
| Tkinter 图形界面      | 使用窗口形式展示主界面与结果        | Could  |
| 聚类结果自动命名标签        | 根据 RFM 特征自动生成客户群名称    | Could  |
| 语音播报个性设置          | 切换语速、音色等高级配置          | Could  |

> 实施策略：优先确保 **Must** 功能全部可运行并可演示，再根据时间情况补充 Should / Could 功能。

---

## 七、非功能需求（毕业设计级别）

### 7.1 运行环境

* 操作系统：Windows 10/11（本地开发与演示）
* Python 版本：Python 3.9+
* 依赖安装方式：`pip` 离线或在线安装第三方库
* 无需联网即可完成主要功能（除非人工选择在线安装依赖）

### 7.2 性能要求

* 数据量：约 1 万行订单明细级数据，可在数秒内完成加载与主要分析；
* 聚类、回归等算法在普通笔记本上运行时间控制在数秒级；
* 不考虑高并发访问，仅本机单用户操作。

### 7.3 可用性要求

* 提供清晰的主菜单或主界面，功能入口清晰；
* 对关键操作（如重新计算、导出）给出提示信息；
* 程序出现常见错误（路径错误、文件缺失等）时，给出中文提示而不是直接崩溃。

### 7.4 安全性要求

* 不涉及真实敏感个人信息，仅使用课程提供的样例数据；
* 不连接外部网络服务，不涉及支付、登录等高风险功能；
* 源码与数据文件本地存放，按课程要求备份。

### 7.5 可维护性与扩展性

* 按模块拆分 Python 文件，例如：`data_loader.py`、`recommender.py`、`promotion.py`、`forecast.py`、`clustering.py`、`tts.py` 等；
* 在关键算法函数前编写简要中文注释，便于同学与老师阅读；
* 保留一定扩展空间，例如后续可替换回归模型、增加新的促销规则。
